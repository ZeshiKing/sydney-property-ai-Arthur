<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¾³æ´²ç§Ÿæˆ¿èšåˆç³»ç»Ÿ - å‰ç«¯APIæµ‹è¯•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 40px;
            padding: 25px;
            border: 1px solid #e1e5e9;
            border-radius: 10px;
            background: #f8f9fa;
        }

        .section h2 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
        }

        .form-group input, .form-group select {
            width: 100%;
            max-width: 300px;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-row {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 15px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }

        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 500;
        }

        .status.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .status.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .status.loading {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
            position: relative;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #0c5460;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .results {
            max-height: 600px;
            overflow-y: auto;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: white;
        }

        .property-card {
            border-bottom: 1px solid #e2e8f0;
            padding: 20px;
            transition: background-color 0.2s ease;
        }

        .property-card:hover {
            background: #f7fafc;
        }

        .property-card:last-child {
            border-bottom: none;
        }

        .property-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 10px;
        }

        .property-price {
            font-size: 1.5em;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 15px;
        }

        .property-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .property-meta {
            font-size: 0.9em;
            color: #718096;
            border-top: 1px solid #e2e8f0;
            padding-top: 15px;
        }

        .features {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .feature-tag {
            background: #edf2f7;
            color: #4a5568;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 500;
        }

        .code-block {
            background: #1a202c;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 15px 0;
        }

        .api-endpoint {
            background: #2d3748;
            color: #68d391;
            padding: 8px 12px;
            border-radius: 6px;
            font-family: monospace;
            font-weight: 600;
            display: inline-block;
            margin: 5px 0;
        }

        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 15px;
            border-radius: 25px;
            color: white;
            font-weight: 600;
            z-index: 1000;
        }

        .connection-status.connected {
            background: #48bb78;
        }

        .connection-status.disconnected {
            background: #e53e3e;
        }
    </style>
</head>
<body>
    <div class="connection-status" id="connectionStatus">æ£€æŸ¥è¿æ¥ä¸­...</div>

    <div class="container">
        <div class="header">
            <h1>ğŸ  æ¾³æ´²ç§Ÿæˆ¿èšåˆç³»ç»Ÿ</h1>
            <p>å‰ç«¯APIè¿æ¥æµ‹è¯•å·¥å…· - Python FastAPI ç‰ˆæœ¬</p>
        </div>

        <div class="content">
            <!-- è¿æ¥æ£€æŸ¥éƒ¨åˆ† -->
            <div class="section">
                <h2>ğŸ”— åç«¯è¿æ¥æ£€æŸ¥</h2>
                <p>é¦–å…ˆæ£€æŸ¥åç«¯APIæœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œï¼š</p>

                <button class="btn" onclick="checkConnection()">æ£€æŸ¥åç«¯è¿æ¥</button>
                <button class="btn btn-secondary" onclick="checkApiDocs()">æ‰“å¼€APIæ–‡æ¡£</button>

                <div class="code-block">
                    <strong>åç«¯åœ°å€:</strong><br>
                    å¼€å‘ç¯å¢ƒ: <span class="api-endpoint">http://localhost:8000</span><br>
                    APIæ–‡æ¡£: <span class="api-endpoint">http://localhost:8000/docs</span><br>
                    å¥åº·æ£€æŸ¥: <span class="api-endpoint">http://localhost:8000/health</span>
                </div>

                <div id="connectionResult"></div>
            </div>

            <!-- æˆ¿äº§æœç´¢éƒ¨åˆ† -->
            <div class="section">
                <h2>ğŸ” æˆ¿äº§æœç´¢æµ‹è¯•</h2>
                <p>æµ‹è¯•å®æ—¶æˆ¿äº§æœç´¢åŠŸèƒ½ï¼š</p>

                <form id="searchForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="location">æœç´¢åŒºåŸŸ *</label>
                            <input type="text" id="location" value="Camperdown" required>
                        </div>

                        <div class="form-group">
                            <label for="propertyType">æˆ¿äº§ç±»å‹</label>
                            <select id="propertyType">
                                <option value="">æ‰€æœ‰ç±»å‹</option>
                                <option value="Apartment">å…¬å¯“</option>
                                <option value="House">ç‹¬ç«‹å±‹</option>
                                <option value="Townhouse">è”æ’åˆ«å¢…</option>
                                <option value="Studio">å·¥ä½œå®¤</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="minPrice">æœ€ä½ä»·æ ¼ (å‘¨ç§Ÿ)</label>
                            <input type="number" id="minPrice" value="500">
                        </div>

                        <div class="form-group">
                            <label for="maxPrice">æœ€é«˜ä»·æ ¼ (å‘¨ç§Ÿ)</label>
                            <input type="number" id="maxPrice" value="1000">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="bedrooms">å§å®¤æ•°é‡</label>
                            <input type="number" id="bedrooms" value="2" min="0" max="10">
                        </div>

                        <div class="form-group">
                            <label for="bathrooms">æµ´å®¤æ•°é‡</label>
                            <input type="number" id="bathrooms" value="1" min="0" max="10">
                        </div>

                        <div class="form-group">
                            <label for="maxResults">æœ€å¤§ç»“æœæ•°</label>
                            <input type="number" id="maxResults" value="10" min="1" max="50">
                        </div>
                    </div>

                    <button type="submit" class="btn" id="searchBtn">ğŸ” æœç´¢æˆ¿äº§</button>
                </form>

                <div id="searchStatus"></div>
                <div id="searchResults" class="results" style="display: none;"></div>
            </div>

            <!-- ä»£ç ç¤ºä¾‹éƒ¨åˆ† -->
            <div class="section">
                <h2>ğŸ’» å‰ç«¯é›†æˆä»£ç ç¤ºä¾‹</h2>
                <p>ä»¥ä¸‹æ˜¯æ‚¨çš„å‰ç«¯ä»£ç å¯ä»¥å‚è€ƒçš„APIè°ƒç”¨ç¤ºä¾‹ï¼š</p>

                <h3>JavaScript fetchç¤ºä¾‹:</h3>
                <div class="code-block">async function searchProperties(searchParams) {
  try {
    const response = await fetch('http://localhost:8000/api/v1/properties/search', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(searchParams)
    });

    const data = await response.json();

    if (data.success) {
      console.log(`âœ… æ‰¾åˆ° ${data.properties.length} ä¸ªæˆ¿äº§`);
      return data.properties;
    } else {
      console.error('âŒ æœç´¢å¤±è´¥:', data.message);
      return [];
    }
  } catch (error) {
    console.error('ğŸš¨ ç½‘ç»œé”™è¯¯:', error);
    return [];
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const searchParams = {
  location: "Camperdown",
  min_price: 500,
  max_price: 1000,
  bedrooms: 2,
  property_type: "Apartment"
};

searchProperties(searchParams).then(properties => {
  // åœ¨è¿™é‡Œå¤„ç†è¿”å›çš„æˆ¿äº§æ•°æ®
  properties.forEach(property => {
    console.log(`ğŸ  ${property.title} - ${property.price}`);
  });
});</div>

                <h3>Axiosç¤ºä¾‹:</h3>
                <div class="code-block">import axios from 'axios';

const API_BASE_URL = 'http://localhost:8000';

const api = axios.create({
  baseURL: API_BASE_URL,
  timeout: 30000,
  headers: {
    'Content-Type': 'application/json'
  }
});

export const searchProperties = async (searchParams) => {
  try {
    const response = await api.post('/api/v1/properties/search', searchParams);
    return response.data;
  } catch (error) {
    console.error('APIè°ƒç”¨å¤±è´¥:', error);
    throw error;
  }
};</div>

                <h3>React Hookç¤ºä¾‹:</h3>
                <div class="code-block">import { useState } from 'react';

const usePropertySearch = () => {
  const [properties, setProperties] = useState([]);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);

  const searchProperties = async (searchParams) => {
    setLoading(true);
    setError(null);

    try {
      const response = await fetch('http://localhost:8000/api/v1/properties/search', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(searchParams)
      });

      const data = await response.json();

      if (data.success) {
        setProperties(data.properties);
      } else {
        setError(data.message);
      }
    } catch (err) {
      setError('ç½‘ç»œè¿æ¥å¤±è´¥');
    } finally {
      setLoading(false);
    }
  };

  return { properties, loading, error, searchProperties };
};</div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8000';

        // æ£€æŸ¥åç«¯è¿æ¥çŠ¶æ€
        async function checkConnection() {
            const statusEl = document.getElementById('connectionResult');
            const connectionStatus = document.getElementById('connectionStatus');

            statusEl.innerHTML = '<div class="status loading"><div class="loading-spinner"></div>æ­£åœ¨æ£€æŸ¥åç«¯è¿æ¥...</div>';

            try {
                const response = await fetch(`${API_BASE_URL}/health`, {
                    method: 'GET',
                    timeout: 10000
                });

                const data = await response.json();

                if (response.ok && data.status === 'healthy') {
                    statusEl.innerHTML = `
                        <div class="status success">
                            âœ… <strong>åç«¯è¿æ¥æ­£å¸¸!</strong><br>
                            æœåŠ¡ç‰ˆæœ¬: ${data.version || 'æœªçŸ¥'}<br>
                            å“åº”æ—¶é—´: ${Date.now() - startTime}ms<br>
                            æ—¶é—´æˆ³: ${new Date().toLocaleString('zh-CN')}
                        </div>
                    `;
                    connectionStatus.textContent = 'âœ… å·²è¿æ¥';
                    connectionStatus.className = 'connection-status connected';

                    // è‡ªåŠ¨è·å–APIè¯¦ç»†å¥åº·çŠ¶æ€
                    checkDetailedHealth();
                } else {
                    throw new Error(`æœåŠ¡çŠ¶æ€å¼‚å¸¸: ${data.status || 'unknown'}`);
                }
            } catch (error) {
                statusEl.innerHTML = `
                    <div class="status error">
                        âŒ <strong>åç«¯è¿æ¥å¤±è´¥!</strong><br>
                        é”™è¯¯: ${error.message}<br><br>
                        <strong>è§£å†³æ­¥éª¤:</strong><br>
                        1. ç¡®è®¤åç«¯æœåŠ¡å·²å¯åŠ¨<br>
                        2. æ£€æŸ¥åœ°å€æ˜¯å¦æ­£ç¡®: ${API_BASE_URL}<br>
                        3. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯<br>
                        4. æ£€æŸ¥CORSè®¾ç½®
                    </div>
                `;
                connectionStatus.textContent = 'âŒ æœªè¿æ¥';
                connectionStatus.className = 'connection-status disconnected';
            }
        }

        // æ£€æŸ¥è¯¦ç»†å¥åº·çŠ¶æ€
        async function checkDetailedHealth() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/v1/health/`);
                const data = await response.json();

                const currentStatus = document.getElementById('connectionResult');
                const detailsHtml = `
                    <div class="status success">
                        ğŸ” <strong>è¯¦ç»†ç³»ç»ŸçŠ¶æ€:</strong><br>
                        æ•°æ®åº“: ${data.services?.database?.status || 'æœªçŸ¥'}
                        (${data.services?.database?.response_time_ms || 0}ms)<br>
                        ç¼“å­˜: ${data.services?.redis?.status || 'æœªçŸ¥'}
                        (${data.services?.redis?.response_time_ms || 0}ms)<br>
                        Firecrawl API: ${data.services?.firecrawl?.status || 'æœªçŸ¥'}
                        (${data.services?.firecrawl?.response_time_ms || 0}ms)
                    </div>
                `;
                currentStatus.innerHTML += detailsHtml;
            } catch (error) {
                console.log('è¯¦ç»†å¥åº·æ£€æŸ¥å¤±è´¥:', error);
            }
        }

        // æ‰“å¼€APIæ–‡æ¡£
        function checkApiDocs() {
            window.open(`${API_BASE_URL}/docs`, '_blank');
        }

        // æˆ¿äº§æœç´¢
        document.getElementById('searchForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const searchBtn = document.getElementById('searchBtn');
            const statusEl = document.getElementById('searchStatus');
            const resultsEl = document.getElementById('searchResults');

            // æ”¶é›†è¡¨å•æ•°æ®
            const searchParams = {
                location: document.getElementById('location').value,
                min_price: parseInt(document.getElementById('minPrice').value) || undefined,
                max_price: parseInt(document.getElementById('maxPrice').value) || undefined,
                bedrooms: parseInt(document.getElementById('bedrooms').value) || undefined,
                bathrooms: parseInt(document.getElementById('bathrooms').value) || undefined,
                property_type: document.getElementById('propertyType').value || undefined,
                max_results: parseInt(document.getElementById('maxResults').value) || 10
            };

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            searchBtn.disabled = true;
            searchBtn.innerHTML = '<div class="loading-spinner"></div>æœç´¢ä¸­...';
            statusEl.innerHTML = '<div class="status loading"><div class="loading-spinner"></div>æ­£åœ¨æœç´¢æˆ¿äº§æ•°æ®...</div>';
            resultsEl.style.display = 'none';

            const startTime = Date.now();

            try {
                const response = await fetch(`${API_BASE_URL}/api/v1/properties/search`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(searchParams)
                });

                const data = await response.json();
                const searchTime = Date.now() - startTime;

                if (data.success && data.properties) {
                    // æ˜¾ç¤ºæˆåŠŸçŠ¶æ€
                    statusEl.innerHTML = `
                        <div class="status success">
                            âœ… <strong>æœç´¢æˆåŠŸ!</strong><br>
                            æ‰¾åˆ° ${data.properties.length} ä¸ªæˆ¿äº§<br>
                            æœç´¢è€—æ—¶: ${searchTime}ms<br>
                            æœåŠ¡å™¨å¤„ç†æ—¶é—´: ${data.metadata?.search_time_ms?.toFixed(1) || 'æœªçŸ¥'}ms
                        </div>
                    `;

                    // æ˜¾ç¤ºæˆ¿äº§ç»“æœ
                    displayProperties(data.properties, data.metadata);
                    resultsEl.style.display = 'block';

                } else {
                    statusEl.innerHTML = `
                        <div class="status error">
                            âŒ <strong>æœç´¢å¤±è´¥:</strong> ${data.message || 'æœªçŸ¥é”™è¯¯'}
                        </div>
                    `;
                }

            } catch (error) {
                statusEl.innerHTML = `
                    <div class="status error">
                        ğŸš¨ <strong>ç½‘ç»œé”™è¯¯:</strong> ${error.message}<br><br>
                        è¯·æ£€æŸ¥:
                        <br>1. åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ
                        <br>2. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
                        <br>3. æµè§ˆå™¨æ§åˆ¶å°çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯
                    </div>
                `;
            } finally {
                searchBtn.disabled = false;
                searchBtn.innerHTML = 'ğŸ” æœç´¢æˆ¿äº§';
            }
        });

        // æ˜¾ç¤ºæˆ¿äº§æ•°æ®
        function displayProperties(properties, metadata) {
            const resultsEl = document.getElementById('searchResults');

            if (!properties || properties.length === 0) {
                resultsEl.innerHTML = '<div class="property-card">æœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„æˆ¿äº§</div>';
                return;
            }

            let html = '';
            properties.forEach((property, index) => {
                html += `
                    <div class="property-card">
                        <div class="property-title">${property.title}</div>
                        <div class="property-price">${property.price}</div>

                        <div class="property-details">
                            <div><strong>ä½ç½®:</strong> ${property.location}</div>
                            <div><strong>æˆ¿é—´:</strong> ${property.bedrooms || 'N/A'}å®¤ ${property.bathrooms || 'N/A'}æµ´</div>
                            <div><strong>åœè½¦:</strong> ${property.parking || 0}ä¸ªè½¦ä½</div>
                            <div><strong>ç±»å‹:</strong> ${property.property_type}</div>
                        </div>

                        <div><strong>æè¿°:</strong> ${property.description}</div>

                        ${property.features && property.features.length > 0 ? `
                            <div class="features">
                                ${property.features.map(feature => `<span class="feature-tag">${feature}</span>`).join('')}
                            </div>
                        ` : ''}

                        <div class="property-meta">
                            <strong>ä¸­ä»‹:</strong> ${property.agent?.name || 'æœªçŸ¥'}
                            ${property.agent?.phone ? `- ${property.agent.phone}` : ''}<br>
                            <strong>æ•°æ®æ¥æº:</strong> ${property.source}<br>
                            <strong>æ›´æ–°æ—¶é—´:</strong> ${new Date(property.scraped_at).toLocaleString('zh-CN')}<br>
                            ${property.url ? `<strong>åŸç½‘é¡µ:</strong> <a href="${property.url}" target="_blank">æŸ¥çœ‹è¯¦æƒ…</a>` : ''}
                        </div>
                    </div>
                `;
            });

            resultsEl.innerHTML = html;
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥è¿æ¥
        window.addEventListener('load', () => {
            setTimeout(checkConnection, 1000);
        });

        // è®°å½•æœç´¢å¼€å§‹æ—¶é—´
        let startTime;

        // æ›´æ–°è¿æ¥çŠ¶æ€æ˜¾ç¤º
        function updateConnectionStatus() {
            fetch(`${API_BASE_URL}/health`)
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'healthy') {
                        document.getElementById('connectionStatus').textContent = 'âœ… å·²è¿æ¥';
                        document.getElementById('connectionStatus').className = 'connection-status connected';
                    }
                })
                .catch(() => {
                    document.getElementById('connectionStatus').textContent = 'âŒ æœªè¿æ¥';
                    document.getElementById('connectionStatus').className = 'connection-status disconnected';
                });
        }

        // æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡è¿æ¥çŠ¶æ€
        setInterval(updateConnectionStatus, 30000);
    </script>
</body>
</html>